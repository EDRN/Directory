#!${buildout:executable}
# encoding: utf-8
#
# EDRN Directory Service â€” Script to launch Apahce Directory Server
#
# Note that the file templates/apacheds generates bin/apacheds; are you
# editing the right file?
#
# Copyright 2012 California Institute of Technology. ALL RIGHTS
# RESERVED. U.S. Government Sponsorship acknowledged.

import os, os.path

# These are set by collective.recipe.template:
apacheds = '${apacheds:location}'
conffile = '${apacheds-config:output}'
logfile = '${apacheds-log-config:output}'
java = '${paths:java}'

# Figure out the classpath
libdir = os.path.join(apacheds, 'lib')
jars = [os.path.join(libdir, i) for i in os.listdir(libdir)]

# Do it
os.execl(
	java,
	'java',
	'-Dlog4j.configuration=file:' + logfile,
	'-cp',
	':'.join(jars),
	'org.apache.directory.server.UberjarMain',
	conffile
)
